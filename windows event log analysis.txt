let's learn about complete Windows event log analysis
Windows log management comprises collecting, storing, analyzing, and monitoring logs from Microsoft Windows operating system and Windows applications
Windows Event Logs are an integral part of Windows event logging. Windows event logs include both actions taken by users and by processes executing on the computer.
An event log is a chronological record of system, security, and application events on a Windows operating system computer.
Windows activity logs are detailed records kept by the Windows operating system of many different events associated with system operation, user activities, security, and application functioning.
There are 5 main types of logs in windows
   system logs generated by the windows os ( startup, shutdown, driver failures, hardware issues)
   Monitoring changes in files, especially in critical directories like System32 or suspicious temporary directories. (File System Monitoring)
   application logs related to the apps installed in the system (app crashes, errors, warnings)
   = Monitoring application logs assists administrators in diagnosing and solving application problems, thereby ensuring the reliability and availability of vital business 
     applications
   security logs track events like successful and failed login attempts, resource access like files, folders, system settings, privilege escalations, policy changes
     =This is important for auditing purposes and ensuring compliance with security policies, helping to maintain the integrity and security of the system.
   setup logs are generated when we are setting up the machine like Windows ( installation process, setup configurations)
     =Setup Configurations: Records information about system configurations during the setup process.
    = Setup log files record events associated with the success and failure of installations, configuration changes, and setup-related errors. 
    = Monitoring setup logs is the key to verification of successful deployment of software updates and new applications, as well as troubleshooting installation and 
      configuration issues. 
   forwarded events are centralized logs from multiple computers sent to a single Windows event collector(useful for centralized Windows log monitoring)
   Windows Powershell logs keep track of events related to PowerShell script execution, cmdlet usage, and administrative actions carried out using PowerShell.
Windows Event Viewer is a Windows application that lets you see your computer's logs, warnings, and other events. Each application you open generates entries that are recorded in an activity log, which can be viewed from the Event Viewer.
Windows Log Location = C:\\Windows\\System32\\winevt\\Logs
The key components of an Event Viewer entry are:
Date and Time: When the event occurred.
Source: The application or system component that generated the event.
Event ID: A unique identifier for the event type.
Level: The severity of the event (Information, Warning, Error, Critical).
User: The user account under which the event occurred.
Computer: The name of the computer where the event was logged.
Description: Detailed information about the event.
============================================= SIEM INSTALLATION PATHS =================================
Now based on different siem tools they might install agents in different places in different folders
During installation, administrators may choose custom paths.
C:\Program Files (x86)\, Program Files\Splunk
Main event log files are stored in C:\\Windows\\System32\\winevt\\Logs
To determine the exact location of the SIEM agent on a specific system, you can look for the following:
Control Panel: Check the list of installed programs to find the SIEM agent.
## method 1: Using the Registry Editor##
Open Registry Editor:
Press Win + R, type regedit, and press Enter.
Navigate to SIEM Agent Keys:
Common locations to check include:
HKEY_LOCAL_MACHINE\SOFTWARE\
HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\ you will find the location where the agent is installed
============================ Registry Events, WMI, and HKEY Concepts =========================================
This “Registry” is a special database that keeps all the important instructions for how Windows, its programs, and hardware work together.
The Windows Registry is a centralized key-value database that stores permissions, user data, and configuration settings for the Windows operating system and many Windows native applications
 The keys stored in the registry provide a granular view into the processes occurring on a Windows host, such as certificate expirations, security checks, and pending reboots.
The Windows Registry is a hierarchical database where Windows stores configuration settings.
HKEY_LOCAL_MACHINE (HKLM) and HKEY_CURRENT_USER (HKCU) are important hives. Attackers can modify registry keys in these hives to establish persistence or escalate privileges.
WMI (Windows Management Instrumentation)
WMI allows for querying information from a system or performing actions on remote machines.
Attackers can abuse WMI to execute remote commands or move laterally between systems without dropping files on disk (fileless malware).
Event logs for WMI can indicate such suspicious activity.  
WMI logs can be found under the following path in Event Viewer
WMI (Windows Management Instrumentation) Logs  Applications and Services Logs > Microsoft > Windows > WMI-Activity    WMI-Activity/Operational
Windows Registry logs are stored under Security Event Logs in Event Viewer: Windows Logs > Security
PowerShell Logs: Applications and Services Logs > Microsoft > Windows > PowerShell/Operational some logs might be under Windows PowerShell in the Security and System logs.
sysmon is a powerful Windows system service that provides detailed information about process creation, network connections, file creation, and changes in the system. 
It generates logs that are more granular than native Windows logs.
Sysmon events are stored under:
Applications and Services Logs > Microsoft > Windows > Sysmon/Operational
Audit Policies  Windows allows admins to configure audit policies to log specific actions like object access, registry changes, process creation, and privilege escalation.
Monitoring LOLBAS tools involves tracking Process creation WMI activity PowerShell logging 
 Windows Registry is a hierarchical database that stores low-level settings for the Microsoft Windows operating system and for applications that opt to use the registry on runtime
Adversaries use various techniques to achieve persistence on the network and connect back to their CnC ( Command and Control ) server. The most common way is Registry key value modification
What are the Run keys in the Registry?
registry holds a set of keys, which will handle the operating system setting for the device drivers, services, Security Accounts Manager, user interface, etc.
 Adding the new string under the run key will execute a specific program at user boot or logon.
to open the registry editor press windows + r and type regedit > You will find the computer, hkey class root, hkey current user, hkey local machine, hkey users, hkey current configurations type folders on the left panel
in registry editor > computer> HKEY_CURRENT > MICROSOFT > IF YOU ADDED A NEW STRING IT WILL RUN AT BOOT PROCESS THIS IS HOW ATTACKERS DO
Threat actors May use Windows terminal to add their specific application which needs to be executed the next boot time
Below registry keys can also help attackers to be persistent on Windows for a long time to steal confidential data and exfiltrate their domains.
HKLM\Software\Microsoft\Windows\CurrentVersion\Run: Often used by attackers to auto-launch malware at startup.
HKLM\SYSTEM\CurrentControlSet\Services: Attackers often create new services to maintain persistence.
HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Run
HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\RunOnce
HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\RunOnce
KEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Explorer\Shell Folders
HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\User Shell Folders
HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer\Run
HKEY_LOCAL_MACHINE\Software\Microsoft\Windows NT\CurrentVersion\Winlogon\Userinit
In addition to one of the above behaviors, Figure out & find the Event ID: 4657 in your Log analytics tool. This event ID will help soc analysts /Incident responders to find the registry value changes.
APT-Hunter is the threat-hunting tool for Windows event logs which will detect APT movements and uncover suspicious activities
Gather and analyze ( Sysmon , Security , System , Powershell , Powershell_Operational , ScheduledTask , WinRM , TerminalServices , Windows_Defender ) .
A Guide to Windows Directories for SOC Analysts
Yes, the Windows Registry can come under File Integrity Monitoring (FIM) in certain contexts
File Integrity Monitoring (FIM) refers to the process of monitoring and detecting changes to critical files, directories, and system configurations.
It's used to ensure that sensitive system files and configurations have not been tampered with by unauthorized users, malware, or attackers.
Mention the Keypath that you want to monitor
You find a log from the Windows Registry with the subkey:
HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon and with a value that has just changed from 0 to 1, indicating that this machine has recently been switched to automatic logon.
HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon and with a value that has just changed from 0 to 1, indicating that this machine has recently been switched to automatic logon. 
in this, it says converting from zero to 1 indicates automatic login but when these events are trigging with wazuh, splunk, or other tools sometimes it might happen because of system settings or automatic when to consider these registry events are malicious
In Windows environments, the registry key HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon with its specific values can indeed be manipulated to enable automatic logon, 
which could either be a legitimate system change or an indicator of malicious activity.
Check for Administrative Context
Legitimate Use: If an authorized user or IT admin has enabled automatic logon for system convenience (e.g., for a shared system or a test environment), it is likely benign.
Malicious Use: An attacker may enable automatic logon after gaining access to maintain persistence and ensure they don’t have to re-enter credentials after rebooting the system. This could be done post-exploitation, such as after installing malware or backdoors.
 User Activity and Account Context
If the change is linked to an administrator or system account, it could be part of standard configuration.
If the change is linked to an unfamiliar user account, especially one with elevated privileges, that could be suspicious.
Correlate with Group Policy or Other System Settings
If the change aligns with Group Policy settings or other automation tools, it could be benign. Review logs or policies for any recent changes in automatic logon behavior.
If this change occurs independently of known system policies, it could be the result of tampering.
Changes to key registry hives or specific keys (e.g., Run, RunOnce, Services, etc.) can indicate potential security risks, such as malware trying to maintain persistence or unauthorized changes to system settings.
Group Policy is a feature in Microsoft Windows that provides centralized management and configuration of operating systems, applications, and user settings in an Active Directory environment
 It allows IT administrators to define rules for users and computers within an organization, controlling aspects such as security settings, user interface behavior, system configurations, and software installation.
In a nutshell, the Windows Registry is a powerful tool for advanced users to customize their computers, but it’s also a place where you should tread carefully to avoid problem
The Registry is like the heart of your computer. It helps everything run smoothly. Skilled users can use it to make their computer do extraordinary things that aren’t usually possible.

Windows Registry in Cybersecurity:

Configuration Management: It stores settings that control how your operating system and software behave. Cyber attackers may manipulate these settings to perform malicious activities, such as automatically running malware upon system startup.

Persistence: Cyber threats aim to establish persistence on compromised systems, allowing them to maintain control and continue their malicious activities. Achieving persistence often involves modifying the Registry to ensure that malicious code runs consistently.

Evasion: Attackers may employ rootkits and other techniques to hide their presence from security software. These techniques often involve manipulating the Registry to bypass security measures.
Anomalous Timestamps: Keep an eye on the timestamps of registry key modifications. Unexpected changes during non-standard hours or in close proximity to security incidents can be a red flag.
Unrecognized Software: If you encounter unfamiliar software, scripts, or executables in the registry, investigate their origins and purposes.

Integrity Verification Tools: Use tools like Windows File Protection (WFP) or Windows Resource Protection (WRP) to check the integrity of key system files and their corresponding registry settings.
Example: Running a WRP scan reveals inconsistencies between system files and their registry configurations.

question 
i have a doubt when attackers try to change any windows registry file to avoid detection or evasion ,may be we can keep a correct of the windows key files and
using group policy can we push in the user machine as a security practise 

Attackers often target the registry to hide their presence or evade detection. Implementing a strategy to ensure the integrity of these files can help detect and mitigate such activities.
Step 1: Baseline the Registry
Use a tool like regedit or PowerShell to export the current state of the registry keys you want to monitor.
Save these exports in a secure location.
 Implement Integrity Checking
Use a hashing algorithm (e.g., SHA-256) to create a hash of the registry files. This hash serves as a unique identifier for the current state of the files.
Store these hashes in a secure location.
Schedule Regular Integrity Checks:

Use a script or a monitoring tool to periodically check the hashes of the registry files against the stored hashes.
Tools like PowerShell, Sysinternals Suite (e.g., PsExec, PsTools), or third-party solutions like Tripwire can be used for this purpose.
Step 3: Use Group Policy to Push Configuration
Create a Group Policy Object (GPO):

Open the Group Policy Management Console (GPMC).
Create a new GPO or edit an existing one.
Configure Scripts:

Navigate to Computer Configuration -> Policies -> Windows Settings -> Scripts (Startup/Shutdown).
Add a startup script that runs the integrity check script.
Deploy the GPO:

Link the GPO to the appropriate Organizational Units (OUs) in Active Directory.
Ensure that the GPO is applied to all relevant machines.
Step 4: Monitor and Alert
Monitor Logs:

Ensure that the integrity check script logs any discrepancies found.
Use a centralized logging solution (e.g., SIEM) to collect and analyze these logs.
Alert on Changes:

Configure alerts to notify the security team whenever a discrepancy is detected.
This can be done using the logging and alerting capabilities of your SIEM or other monitoring tools.
did i asked the right question and what about sometime those registry files will automatically change or get updated so the 
hash values will also change when created a script to check the hash value and then both does match will it cause error

Strategies to Handle Legitimate Changes
Version Control:

Maintain a version history of the registry files. This can help you track changes over time and determine if a change is legitimate or not.
Whitelisting Changes:

Create a whitelist of expected changes. For example, if you know that a specific update will modify a certain registry key, you can note this in your whitelist.
Time-Based Monitoring:

Implement time-based monitoring to detect sudden, unexpected changes. Legitimate updates often occur during specific maintenance windows or update cycles.
Change Logs:

Use change logs to track authorized changes. This can help you quickly identify and verify if a change is expected.
Baseline Updates:

Periodically update your baseline to include legitimate changes. This ensures that your monitoring tools are aware of the new state and can detect future unauthorized changes more effectively.

Interview Answer: "Yes, attackers often try to modify critical registry keys in Windows to evade detection or disable security settings.
One way to mitigate this risk is by using Group Policy to push the correct registry values and ensure they stay consistent across the network.
For example, if an attacker tries to modify a key like AutoAdminLogon or disable UAC settings, Group Policy can automatically revert the changes, maintaining system security.

Additionally, by combining Group Policy enforcement with registry auditing, we can detect unauthorized changes in real-time and send alerts to SIEM tools like Wazuh or Splunk. 
This approach not only prevents malicious modifications but also provides visibility into potential evasion attempts.
It's a proactive defense mechanism that can help maintain the integrity of critical system configurations in a large-scale environment."

Audit and Monitor Registry Changes: In addition to enforcing registry settings via Group Policy, you should enable auditing to detect unauthorized changes to critical registry keys.
This allows you to log any changes made to the specified registry values, which can help you detect tampering or evasion attempts.
You can combine this with auditing and alerting mechanisms via SIEM tools (like Wazuh or Splunk) to detect any attempt to tamper with critical registry settings. Alerts can be triggered when unauthorized changes occur

To audit changes to critical registry keys, I would enable Windows built-in auditing for those specific keys. The process involves configuring Group Policy to track any changes made to the registry, and this can log both successful and failed attempts to modify the key.

My focus would be on monitoring high-risk areas, such as:

Winlogon keys that manage user login behavior,
Run and RunOnce keys that control startup applications,
Windows Defender and security settings keys, and
Keys related to system services and network policies.

HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services
HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control

Here are the key names that I mentioned, along with their full paths:

Service startup behavior:

HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services
Security-related settings:

HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control
LSA (Local Security Authority) settings:

HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Lsa
Session Manager settings:

HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Session Manager
Network configurations:

HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\Tcpip\Parameters
Windows Firewall settings:

HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\SharedAccess\Parameters\FirewallPolicy

 Winlogon Keys: Location: HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon
Run and RunOnce Keys:
HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Run
HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Run
Why: These keys specify programs that run automatically when the user or system starts. Attackers often place malicious programs in these keys to achieve persistence.
3. Lsa Security Keys:
Location: HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Lsa
Why: This registry key contains security settings like EnableLUA (User Account Control) and restrictanonymous (restrict anonymous access). Modifying these can disable important security features like UAC, making the system more vulnerable to privilege escalation attacks.
4. Windows Defender and Security Settings:
Location:
HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Microsoft\Windows Defender
Why: Attackers may disable Windows Defender or other built-in security tools by modifying registry settings, allowing malware to run without detection.
5. System Integrity Settings (SMB, RDP, Network Settings):
Location:
HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\LanmanServer\Parameters (SMB settings)
HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server (RDP settings)
Why: These keys control the remote desktop protocol and SMB settings, which are often targeted for lateral movement, brute-force attacks, or ransomware distribution.
6. Services Keys:
Location: HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services
Why: Attackers may modify or create new service entries to execute malicious binaries on startup. Monitoring these keys helps detect and prevent persistent malware from running.
7. Boot Configuration Keys:
Location: HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Session Manager
Why: This key controls the boot configuration of the system. Attackers can use it to modify the boot-up behavior, such as introducing boot-time malware or disabling system recovery options.
8. Firewall and Network Policies:
Location: HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\SharedAccess\Parameters\FirewallPolicy
Why: Modifying firewall rules via the registry could allow an attacker to open ports for malicious traffic, bypass network protections, or disable the firewall altogether.
9. Software Restriction Policies (AppLocker/Group Policies):
Location: HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Microsoft\Windows\Safer\CodeIdentifiers
Why: These keys manage AppLocker and other software restriction policies. If compromised, they could allow unauthorized applications or scripts to run, bypassing security controls.
10. Audit Policies:
Location: HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System
Why: Registry changes to audit policies can disable logging of critical security events, which allows attackers to cover their tracks and evade detection.
Conclusion:
By protecting these registry keys, we can safeguard critical aspects of system security, such as logon processes, security policies, and automatic execution of programs. These keys are commonly targeted by attackers for persistence or disabling security features, so ensuring their integrity through Group Policy, auditing, and monitoring with SIEM tools is crucial to maintaining system security."

What you're asking for is damn near impossible. Registry keys get changed all the time, and even a fresh install of windows has millions of keys. **********************************************8

If I were to focus on any registry keys it's be the HKLM and HKCU run and runonce keys. If malware is going to use a registry key to establish persistence this is a common location because anything put here is going to run at system start-up.

One of the ways to mitigate is through monitoring for Windows Registry Changes. Enable auditing on the Windows Registry root keys and centralize logs from any Windows Event Log events that will fire off depending on the event. Below are associated events:
Event ID -Title
4656 — A handle to an object was requested
4657 — A registry value was modified
4658 — The handle to an object was closed
4660 — An object was deleted
4663 — An attempt was made to access an object
Log Tampering and Integrity Monitoring
Description: Include how attackers can attempt to manipulate or delete event logs to hide malicious activities and the importance of log integrity monitoring.
Importance: Tampered logs could compromise an investigation. Tools like Sysmon and File Integrity Monitoring (FIM) systems are often used to detect changes.
Scheduled Task and Service Monitoring
Description: Include monitoring scheduled tasks (Event ID 4697) and services for persistence mechanisms attackers use to maintain access.
Importance: Task Scheduler abuse is a common persistence technique, and monitoring these logs can detect such activities.

How a Proxy Helps:
Centralized Web Traffic Control: It inspects, filters, and logs all outgoing web requests from all machines.
Block Malicious Domains: Proxies can block requests to known malicious domains using threat intelligence feeds.
Generate Alerts: When traffic is detected to known or suspected malicious IPs or URLs, alerts can be sent to security teams.
Logging: Proxies log all web activity, allowing for retrospective analysis if an incident is reported (e.g., after a fake pop-up or malicious download).

A Next-Generation Firewall (NGFW) with Deep Packet Inspection (DPI) capabilities can help inspect outbound traffic from all machines and block or flag suspicious connections.

How a Firewall Helps:
Outbound Traffic Filtering: NGFWs can filter outgoing traffic and identify abnormal patterns, like connections to suspicious IP addresses or unusual ports.
DPI for Malware Detection: The firewall inspects outbound traffic for malicious content in real time, including downloads and file transfers.
Application Awareness: Modern firewalls can detect which application or process is making a request (e.g., Firefox vs. an unknown downloader).
Block Suspicious Domains/IPs: Firewalls can block outgoing traffic to known malicious domains using a constantly updated threat intelligence database
The Discretionary Access Control List (DACL) — in charge of allowing/denying access
The System Access Control List (SACL) — which for the most part is used for auditing when attempts of access are made to the target object.

The Security Account Manager (SAM) is a particular registry hive that stores credentials and account information for local users. User passwords are stored in a hashed format in the SAM registry hive either as an LM hash or an NT hash, depending on Group Policy settings.

Files within the System32 directory can potentially be involved in security events, especially if malicious scripts or binaries are executed, which might manipulate system processes.

How the System32 folder might be relevant to logging or monitoring:
Executable Files:

The System32 folder contains a variety of system executables, services, and dynamic link libraries (DLLs). These files can be launched during normal operation or by an attacker if compromised. Monitoring the execution of files in System32 can help detect malicious activities, like LOLBAS (Living off the Land Binaries and Scripts) or other techniques that misuse legitimate system binaries for malicious purposes.
Event Logs Related to Files in System32:

While the System32 folder doesn’t generate logs directly, activity involving files within System32 can trigger Windows Event Logs, such as:
Event ID 4688 (A new process has been created) – Logs when a process is executed, which includes any executable within System32.
Event ID 4689 (A process has exited) – Logs when a process running from System32 terminates.
File Access Logs (Audit Policy):

You can enable Audit Object Access on files within System32 to track access to specific files. This requires configuring Object Access Auditing through Group Policy or Local Security Policy.
Malware and Process Injection:

Malicious software may attempt to inject itself into or replace legitimate System32 binaries for persistence. Monitoring for unusual processes running from this directory, or changes to system files in System32, can help detect fileless malware or rootkits.

NT Hash (NTLM Hash)
The NT (New Technology) or NTLM Hash is a more secure hashing mechanism used in Windows NT and later versions, including modern systems.

It is based on the MD4 hashing algorithm and supports passwords of virtually unlimited length and mixed case.

Unlike LM Hash, the NTLM Hash does not convert passwords to uppercase and is significantly harder to crack, although still not considered fully secure against modern, resource-intensive attacks.

Structure of NT Hash:

The password is processed using the MD4 hashing algorithm, producing a 128-bit hash value.
NTLM Authentication:

NTLM (NT LAN Manager) is a Microsoft security protocol suite that uses the NT Hash for user authentication.
NTLM has two versions: NTLMv1 (older, less secure) and NTLMv2 (more secure and widely used in modern systems).

============================================ LOLBAS Rules ==================================================
The rules in this section detect suspicious behavior related to operating system binaries.

Unusual child processes and DLL loads
Detect starts from non-default locations
Detect proxy execution
Detect UAC bypass
Detect csc/jsc compile
Detect execute from alternate data streams
Detect AWL bypass
Detect encode and decode operations
Detect copy operations
Detect download operations
=======================================================================================================================================
OS Credential Dumping- LSASS Memory vs Windows Logs
Credential dumping is the process of obtaining account login and password information,
normally in the form of a hash or a clear text password, from the operating system and software. 
Credentials can then be used to perform Lateral Movement and access restricted information.
we have the rule to detect it with lsass memory. But still, we are missing more peculiar rules which may evade AV/EDR. 
Those are the techniques listed below:

Suspicious Access to LSASS Memory (Credential Dumping)
Attackers often attempt to dump the contents of LSASS memory to extract credentials. Tools like Mimikatz, ProcDump, and Task Manager may be used to access LSASS memory.

Memory access monitoring: EDRs detect when a non-privileged or suspicious process tries to access the memory of LSASS. This is abnormal behavior and triggers alerts. Some EDRs prevent access to LSASS memory unless specifically allowed (e.g., legitimate debugging).

API call monitoring: EDRs can detect the use of functions such as MiniDumpWriteDump (used to create process dumps) or ReadProcessMemory, which are commonly employed in credential dumping attacks.

Process injection: EDRs detect attempts to inject code into LSASS or other processes to perform credential theft.

Command-line activity: EDRs track tools like ProcDump, Task Manager, or rundll32 being used with suspicious command-line arguments that indicate LSASS memory dumping.

MITRE ATT&CK mapping: Many EDRs map these actions to techniques such as T1003: Credential Dumping from the MITRE ATT&CK framework.

b. Anomalous LSASS Behavior
Process spawning: EDRs flag suspicious processes that spawn from or interact with LSASS. For example, if cmd.exe or powershell.exe attempts to access LSASS or create dumps, this could trigger an alert.

Code execution alerts: When tools or malware attempt to execute code in LSASS, EDRs use behavioral analysis to detect and block such operations.

c. Known Malware Detection
EDRs often include threat intelligence feeds that help identify known malware and toolkits used to dump LSASS, such as Mimikatz or specific process dumping utilities. These are flagged based on signatures, heuristics, or behavior analysis.

Windows Event Logs (Security and Sysmon)
Windows generates security-related event logs that are collected and analyzed by SIEMs. Some key event logs related to LSASS attacks include:

Event ID 4624 (Successful logon): LSASS is involved in logon events. SIEM can detect patterns where multiple failed login attempts (Event ID 4625) are followed by a successful login, indicating a possible brute-force or credential stuffing attack.

Event ID 4673 (Sensitive privilege use): This logs when privileged processes (like LSASS) attempt to perform tasks. SIEM systems can detect suspicious use of sensitive privileges and alert on unusual access to LSASS or its memory.

Event ID 4656 (Handle to an object requested): This event is logged when a process requests access to another process or object. SIEMs can detect unauthorized attempts to access LSASS memory.

Sysmon Event ID 10 (Process access): This event logs when one process opens another for reading or execution. SIEMs can monitor for processes attempting to open LSASS for memory reading.

EDR Rule:
Rule Name: Detect LSASS Memory Access (Credential Dumping)
Logic: Alert when MiniDumpWriteDump or ReadProcessMemory API calls are used to access the memory of lsass.exe by unauthorized processes or tools like procdump.exe or mimikatz.exe.
SIEM Rule:
Rule Name: Detect LSASS Process Dumping Attempts
Logic: Trigger an alert if:
Sysmon Event ID 10 (Process access) shows a non-system process accessing LSASS.
Event ID 4688 (Process creation) logs the execution of known dumping tools (e.g., procdump.exe, mimikatz.exe) targeting lsass.exe.
Event ID 4656 (Handle request) logs unauthorized access to LSASS.

Need to have a detection rule with parent process name as “COMSVCS.DLL” and loading process should be “runDLL32” with a condition of loading process NOT EQUAL TO “COMSVCS.DLL” along with the Sysmon Event ID 7.
























































